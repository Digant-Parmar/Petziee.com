<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Petziee</title>
    <!-- Roboto Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700&display=swap">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="../dp/product css/all css/bootstrap.min.css">
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" href="all css/mdb-pro.min.css">
    <!-- Material Design Bootstrap Ecommerce -->
    <link rel="stylesheet" href="../dp/product css/all css/mdb.ecommerce.min.css">
    <!-- Your custom styles (optional) -->
    <link rel="stylesheet" href="payment.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
    <!-- <link rel="stylesheet" href="style.css"> -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"> -->

    <script src="../include.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>






</head>

<body class="skin-light">
    <!-- https://assets7.lottiefiles.com/packages/lf20_wq6etxix.json -->
    <!--Main Navigation-->
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <lottie-player src="https://assets3.lottiefiles.com/private_files/lf30_ex6xbay5.json" id="lottie" background="transparent" speed="1" style="width: 65%;
    position: fixed;
    margin-top: auto;
    margin-left: 32%;
    z-index: 10;
    display:none" loop autoplay></lottie-player>

    <lottie-player src=" https://assets7.lottiefiles.com/packages/lf20_wq6etxix.json" id="lottieCompleted" background="transparent" speed="1" style="width: 65%;
position: fixed;
margin-top: auto;
margin-left: 32%;
z-index: 10;
display:none" loop autoplay></lottie-player>

    <header>


        <div data-include="navbarPayment"></div>


        <div class="jumbotron color-grey-light mt-70">
            <div class="d-flex align-items-center h-100">
                <div class="container text-center py-5">
                    <h3 class="mb-0">Shopping cart</h3>
                </div>
            </div>
        </div>

    </header>
    <!--Main Navigation-->

    <!--Main layout-->
    <main>
        <div class="container">

            <!--Section: Block Content-->
            <section class="mt-5 mb-4">

                <!--Grid row-->
                <div class="row">

                    <!--Grid column-->
                    <div class="col-lg-8">

                        <!-- Card -->
                        <div class="card wish-list mb-4">
                            <div class="card-body" id="mainCartBody">

                                <form action="lol">
                                    <div class="form" id="addresses">

                                        <!-- <h5 class="mb-4">Choose an Addresses</h5>
                                        <div class="label">
                                            <input type="radio" name="addrRadio" value="0HQsNj57g5B7ridi6uBd" id="0HQsNj57g5B7ridi6uBd">
                                            <label for="0HQsNj57g5B7ridi6uBd"><strong>Digant</strong></label>
                                            <label for="0HQsNj57g5B7ridi6uBd"><strong>Parmar</strong></label>                                           
                                            <label for="0HQsNj57g5B7ridi6uBd"><strong>6354787940</strong></label><br>
                                            <label for="0HQsNj57g5B7ridi6uBd">parmardigant17@gmail.com</label><br>
                                            <label for="0HQsNj57g5B7ridi6uBd">305, Lakshmi kirtan , Rander Road , Tadwadi , Surat, Gujarat, India</label><br>
                                            <label for="0HQsNj57g5B7ridi6uBd">Surat,</label>
                                            <label for="0HQsNj57g5B7ridi6uBd">Gujarat-</label>
                                            <label for="0HQsNj57g5B7ridi6uBd">395009</label><br>
                                        </div> -->
                                    </div>
                                </form>
                                <button class="addbtn" onclick="goToAddAddress()">+ Add a new address</button>
                                <script>
                                    function goToAddAddress() {
                                        window.location.assign("http://petzieee.web.app/address/address.html");
                                    }
                                </script>
                                <p id="demo"></p>
                                <!-- <div class="row mb-4">
                  <div class="col-md-5 col-lg-3 col-xl-3">
                    <div class="view zoom overlay z-depth-1 rounded mb-3 mb-md-0">
                      <img class="img-fluid w-100"
                        src="../dp/image/dog4.jpg" alt="Sample">
                      <a href="#!">
                        <div class="mask waves-effect waves-light">
                          <img class="img-fluid w-100"
                            src="../dp/image/dog4.jpg">
                          <div class="mask rgba-black-slight waves-effect waves-light"></div>
                        </div>
                      </a>
                    </div>
                  </div>
                  <div class="col-md-7 col-lg-9 col-xl-9">
                    <div>
                      <div class="d-flex justify-content-between">
                        <div>
                          <h5>Red hoodie</h5>
                          <p class="mb-3 text-muted text-uppercase small">Hoodie - red</p>
                          <p class="mb-2 text-muted text-uppercase small">Color: red</p>
                          <p class="mb-3 text-muted text-uppercase small">Size: M</p>
                        </div>
                        <div>
                          <div class="def-number-input number-input safari_only mb-0 w-100">
                            <button onclick="this.parentNode.querySelector('input[type=number]').stepDown()"
                              class="minus"></button>
                            <input class="quantity" min="0" name="quantity" value="1" type="number">
                            <button onclick="this.parentNode.querySelector('input[type=number]').stepUp()"
                              class="plus"></button>
                          </div>
                        </div>
                      </div>
                      <div class="d-flex justify-content-between align-items-center">
                        <div>
                          <a href="#!" type="button" class="card-link-secondary small text-uppercase mr-3"><i
                              class="fas fa-trash-alt mr-1"></i> Remove item </a>
                          <a href="#!" type="button" class="card-link-secondary small text-uppercase"><i
                              class="fas fa-heart mr-1"></i> Move to wish list </a>
                        </div>
                        <p class="mb-0"><span><strong><i class="fas fa-rupee-sign"></i> 489.99</strong></span></p>
                      </div>
                    </div>
                  </div>
                </div> -->


                            </div>
                        </div>
                        <!-- Card -->
                        <!-- <p class="text-primary mb-0"><i class="fas fa-info-circle mr-1"></i> Do not delay the purchase, adding items to your cart does not mean booking them.</p> -->
                        <!-- Card -->
                        <!-- <div class="card mb-4">
                            <div class="card-body">

                                <h5 class="mb-4">Expected shipping delivery</h5>

                                <p class="mb-0"> Thu., 12.03. - Mon., 16.03.</p>
                            </div>
                        </div> -->
                        <!-- Card -->

                        <!-- Card -->
                        <div class="card mb-4">
                            <div class="card-body" id="productList">
                                <h5 class="mb-4">We accept</h5>
                                <!-- <div class="sole">
                                    <div class="smallbio" style="width: 15%;">
                                        <img src="../image/banner1.jpg" alt="" style="width: 90%;">
                                    </div>
                                    <div class="bigbio" style="padding-left: 20px;">
                                        <h3 style="font-size: 14px;">Name</h3>
                                        <h5 style="font-size: 12px;">product bio</h5>
                                        <p>more..</p>
                                    </div>
                                </div>

                                <div class="sole" style="margin-top: 20px;">
                                    <div class="smallbio" style="width: 15%;">
                                        <img src="../image/banner1.jpg" alt="" style="width: 90%;">
                                    </div>
                                    <div class="bigbio" style="padding-left: 20px;">
                                        <h3 style="font-size: 14px;">Name</h3>
                                        <h5 style="font-size: 12px;">product bio</h5>
                                        <p>more..</p>
                                    </div>

                                </div> -->
                            </div>
                        </div>



                        <!-- Card -->

                    </div>
                    <!--Grid column-->

                    <!--Grid column-->
                    <div class="col-lg-4">

                        <!-- Card -->
                        <div class="card mb-4 stick">
                            <div class="card-body">

                                <h5 class="mb-3">The total amount of</h5>

                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                                        Total amount
                                        <span><i style="margin-right: 2px;" class="fas fa-rupee-sign"> </i><span id="totalCost"></span></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center px-0" id="ifSaved">
                                        You saved
                                        <span><i style="margin-right: 2px;" class="fas fa-rupee-sign"> </i> <span id="totalDiscount"></span></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                                        <div>
                                            <strong>The total amount of</strong>
                                            <strong>
                        <p class="mb-0">(including VAT)</p>
                      </strong>
                                        </div>
                                        <span><i style="margin-right: 2px;" class="fas fa-rupee-sign"></i><strong id="finalCost"> </strong></span>
                                    </li>
                                </ul>

                                <button type="button" class="btn btn-primary btn-block waves-effect waves-light" id="paynow">Pay Now</button>

                            </div>
                        </div>
                        <!-- Card -->

                        <!-- Card -->
                        <!-- <div class="card mb-4 stic">
                            <div class="card-body">

                                <a class="dark-grey-text d-flex justify-content-between" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                  Add a discount code (optional)
                  <span><i class="fas fa-chevron-down pt-1"></i></span>
                </a>

                                <div class="collapse" id="collapseExample">
                                    <div class="mt-3">
                                        <div class="md-form md-outline mb-0">
                                            <input type="text" id="discount-code" class="form-control font-weight-light" placeholder="Enter discount code">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                        <!-- Card -->

                    </div>
                    <!--Grid column-->

                </div>
                <!--Grid row-->

            </section>
            <!--Section: Block Content-->

        </div>


    </main>


    <!--Main layout-->

    <!-- Footer -->
    <div data-include="footer"></div>

    <!-- Footer -->

    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="../dp/product js/js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="../dp/product js/js/bootstrap.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="../dp/product js/js/mdb.min.js"></script>
    <!-- MDB Ecommerce JavaScript -->
    <script type="text/javascript" src="../dp/product js/js/mdb.ecommerce.min.js"></script>
    <script>
    </script>
    <script defer src="/__/firebase/8.9.1/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/8.9.1/firebase-auth.js"></script>
    <script defer src="/__/firebase/8.9.1/firebase-database.js"></script>
    <script defer src="/__/firebase/8.9.1/firebase-firestore.js"></script>
    <script defer src="/__/firebase/8.9.1/firebase-functions.js"></script>
    <script defer src="/__/firebase/8.9.1/firebase-messaging.js"></script>
    <script defer src="/__/firebase/8.9.1/firebase-storage.js"></script>
    <!-- <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase.js"></script> -->
    <!-- <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-functions.js"></script> -->
    <!-- <script src="https://requirejs.org/docs/release/2.3.5/minified/require.js"></script> -->
    <!-- <script src="payment.js"></script> -->
    <script>
        var addressesArray = [];
        var urlData;
        var cost;
        document.getElementById('paynow').onclick = async function(e) {
            // var x;
            // var totalPrice = 0;
            if (document.querySelector('input[name="addrRadio"]:checked') == null) {
                alert("Please select/add an address");
                return;
            }
            var addressValue = document.querySelector('input[name="addrRadio"]:checked').id;
            if (addressValue == null) {
                alert("Please select/add an address");
                return;
            }
            // const userId = "GVyUWRXPPnUcnD6hKNXh2efmrxR2";
            console.log("Addresses selected is :", addressValue);

            var selectedAddress;
            for (i = 0, l = addressesArray.length; i < l; i++) {
                if (addressesArray[i].id === addressValue) {
                    selectedAddress = addressesArray[i].data();
                }
            }
            // var db = firebase.firestore();

            // var ref = await db.collection("CustomerInfo").doc(currentUser.id).collection("orders").doc();
            // var ref = db.collection("CustomerInfo").doc(userId).collection("orders").doc();

            // if (true) {
            //     // console.log("is if", userId);
            //     return await db.collection("CustomerInfo").doc(userId).collection("cart").get().then(async(qs) => {
            //         // console.log(qs, qs.doc);
            //         for(element of qs.docs){

            //             console.log("Element ud", element.id);
            //             console.log("Element", element);
            //             await db.collection("CustomerInfo").doc(userId).collection("orders").doc(ref.id).collection("products").doc(element.id).set(element.data());
            //             await db.collection("Products").doc(element.id).get().then((value) => {
            //                 var op = value.data().originalPrice;
            //                 var discount = op * value.data().salePerc / 100;
            //                 var finalPrice = (op - discount) * element.data().quantity;
            //                 totalPrice = totalPrice + finalPrice;
            //             });


            //         };
            //         console.log("Total Amount", totalPrice);


            //         // var options = {
            //         //     amount: totalPrice, // amount in the smallest currency unit
            //         //     currency: "INR",
            //         //     receipt: ref.id,
            //         // };
            //         // var temp = instance.orders;
            //         // await temp.create(options, function(err, order) {
            //         //     console.log(JSON.stringify(order));
            //         //     // console.log("returning to the function");
            //         //     db.collection("CustomerInfo").doc(userId).collection("orders").doc(ref.id).update({
            //         //         "orderId": order.body.id,
            //         //         "amount": totalPrice,
            //         //         "status": "created"
            //         //     });
            //         //     x = (JSON.stringify(order));
            //         // });
            //         console.log("x is ", x);

            //     });


            // } else {

            //     return Error;
            // }

            if (selectedAddress == null) {
                alert("Please select/add an address");
                return;
            }



            var db = firebase.firestore();

            // var ref = await db.collection("CustomerInfo").doc(currentUser.id).collection("orders").doc();
            var functions = firebase.functions();

            var razorpay = functions.httpsCallable("razorpay");
            $("body").append('<div id="overlay"></div>');
            $('#lottie').css('display', '');

            if (urlData == null) {
                await razorpay({
                        isCart: true,
                        phone: selectedAddress.phone,
                    })
                    .then((res) => {
                        $('#lottie').css('display', 'none');
                        $('#overlay').remove();
                        result = JSON.parse(res.data);
                        console.log("resule", result);
                        var options = {
                            "key": "rzp_live_zNDp8kSiWigyQ5", // Enter the Key ID generated from the Dashboard
                            "amount": result.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                            "currency": "INR",
                            "name": "Petziee",
                            "description": "For orderId: " + result.id,
                            "image": "https://petziee-dev.web.app/image/sanji.png",
                            "order_id": result.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                            "handler": async function(response) {
                                $("body").append('<div id="overlay"></div>');
                                $('#lottie').css('display', '');

                                console.log(response);
                                // alert(response.razorpay_payment_id);
                                // alert(response.razorpay_order_id);
                                // alert(response.razorpay_signature);

                                var confirmPayment = functions.httpsCallable("confirmPayment");
                                await confirmPayment({
                                    razorpay_order_id: result.id,
                                    razorpay_payment_id: response.razorpay_payment_id,
                                    razorpay_signature: response.razorpay_signature,
                                    id: result.receipt,
                                }).then((value) => {
                                    if (value) {
                                        $('#lottie').css('display', 'none');
                                        $('#lottieCompleted').css('display', '');
                                        // alert("Payment Successfull");
                                        setTimeout(function() {
                                            window.history.go(-3);
                                        }, 4000);

                                    } else {
                                        $('#lottie').css('display', 'none');
                                        $('#overlay').remove();

                                        alert("Payment Unsuccessfull");
                                    }



                                });
                            },
                            "prefill": {
                                "name": selectedAddress.firstName + " " + selectedAddress.lastName,
                                "email": selectedAddress.email,
                                "contact": selectedAddress.phone,

                            },
                            "notes": {
                                "address": selectedAddress.add1 + " " + selectedAddress.add2 + " " + selectedAddress.city + " " + selectedAddress.state + "-" + selectedAddress.pin
                            },
                            "theme": {
                                "color": "#2e2e2e"
                            }
                        };
                        var rzp1 = new Razorpay(options);
                        rzp1.on('payment.failed', function(response) {
                            alert(response.error.code);
                            alert(response.error.description);
                            alert(response.error.source);
                            alert(response.error.step);
                            alert(response.error.reason);
                            alert(response.error.metadata.order_id);
                            alert(response.error.metadata.payment_id);
                        });
                        rzp1.open();
                        e.preventDefault();
                    });

            } else {
                await razorpay({
                        isCart: false,
                        productId: urlData.name,
                        quantity: urlData.quantity,
                        phone: selectedAddress.phone,
                    })
                    .then((res) => {
                        $('#lottie').css('display', 'none');
                        result = JSON.parse(res.data);
                        console.log("resule", result);
                        var options = {
                            "key": "rzp_live_zNDp8kSiWigyQ5", // Enter the Key ID generated from the Dashboard
                            "amount": (cost * 100) + "", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                            "currency": "INR",
                            "name": "Petziee",
                            "description": "For orderID: " + result.id,
                            "image": "https://petziee-dev.web.app/image/sanji.png",
                            "order_id": result.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                            "handler": async function(response) {
                                $("body").append('<div id="overlay"></div>');
                                $('#lottie').css('display', '');

                                console.log(response);
                                // alert(response.razorpay_payment_id);
                                // alert(response.razorpay_order_id);
                                // alert(response.razorpay_signature);

                                var confirmPayment = functions.httpsCallable("confirmPayment");
                                await confirmPayment({
                                    razorpay_order_id: result.id,
                                    razorpay_payment_id: response.razorpay_payment_id,
                                    razorpay_signature: response.razorpay_signature,
                                    id: result.receipt,
                                }).then((value) => {
                                    if (value) {
                                        // alert("Payment Successfull");
                                        $('#lottie').css('display', 'none');
                                        $('#lottieCompleted').css('display', '');

                                        // $('#overlay').remove();

                                        setTimeout(function() {
                                            window.history.go(-2);
                                        }, 4000);

                                    } else {
                                        alert("Payment Unsuccessfull");
                                        $('#lottie').css('display', 'none');
                                        $('#overlay').remove();
                                    }
                                });
                            },
                            "prefill": {
                                "name": selectedAddress.firstName + " " + selectedAddress.lastName,
                                "email": selectedAddress.email,
                                "contact": selectedAddress.phone,

                            },
                            "notes": {
                                "address": selectedAddress.add1 + " " + selectedAddress.add2 + " " + selectedAddress.city + " " + selectedAddress.state + "-" + selectedAddress.pin
                            },
                            "theme": {
                                "color": "#2e2e2e"
                            }
                        };
                        var rzp1 = new Razorpay(options);
                        rzp1.on('payment.failed', function(response) {
                            alert(response.error.code);
                            alert(response.error.description);
                            alert(response.error.source);
                            alert(response.error.step);
                            alert(response.error.reason);
                            alert(response.error.metadata.order_id);
                            alert(response.error.metadata.payment_id);
                        });
                        rzp1.open();
                        e.preventDefault();
                    });


            }

        }

        window.onload = function() {
            var url = document.location.href;
            if (url.split('?')[1] != null) {
                var param = url.split('?')[1].split('&');
                var data = {};
                var tmp;

                for (var i = 0, l = param.length; i < l; i++) {
                    tmp = param[i].split('=');
                    data[tmp[0]] = tmp[1];
                }
                if (Object.keys(data).length === 0) {
                    getInfo();
                } else {
                    urlData = data;
                    forBuyNow(data);
                }
            } else {
                getInfo();

            }

        }

        function forBuyNow(data) {
            console.log("IN forby");
            firebase.initializeApp({
                apiKey: "AIzaSyDHBFSULRYjuXw2YRE9lqxki2C_Cc7-s6A",
                authDomain: "petzieee.firebaseapp.com",
                databaseURL: "https://petzieee-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "petzieee",
                storageBucket: "petzieee.appspot.com",
                messagingSenderId: "779568120586",
                appId: "1:779568120586:web:a44924235200039dffb0f3",
                measurementId: "G-801X9K0951"
            })
            getAddresses();
            buyNow(data);
        }

        function getInfo() {


            console.log("IN getINfo");
            firebase.initializeApp({
                apiKey: "AIzaSyDHBFSULRYjuXw2YRE9lqxki2C_Cc7-s6A",
                authDomain: "petzieee.firebaseapp.com",
                databaseURL: "https://petzieee-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "petzieee",
                storageBucket: "petzieee.appspot.com",
                messagingSenderId: "779568120586",
                appId: "1:779568120586:web:a44924235200039dffb0f3",
                measurementId: "G-801X9K0951"
            })
            getAddresses();
            cart();
        }

        async function getAddresses() {




            // <h5 class="mb-4" id="others">Other addresses</h5>

            // <div class="label">
            //     <input type="radio" id="html" name="fav_language" value="HTML">   <label for="html">First Address</label>
            // </div>

            // <div class="label">
            //     <input type="radio" id="html" name="fav_language" value="HTML">   <label for="html">Second Address</label>
            // </div>

            var db = firebase.firestore();
            firebase.auth().onAuthStateChanged(async(user) => {
                var userId = user.uid;
                const qs = await db.collection("CustomerInfo").doc(userId).collection("addresses").get();
                if (qs.size) {
                    var inital = '<h5 class="mb-4">Choose an Addresses</h5>';
                    await $('#addresses').append(inital);
                    qs.forEach(docs => {
                        addressesArray.push(docs);
                        var temp = '<div class="label">';
                        var add = docs.data();
                        temp = temp + '<input type="radio" name="addrRadio" value = ' + docs.id + ' id=' + docs.id + '>';
                        temp = temp + '<label for=' + docs.id + '><strong>' + add.firstName + '</strong></label>'
                        temp = temp + '<label for=' + docs.id + '><strong>' + add.lastName + '</strong></label>   '
                        temp = temp + '<label for=' + docs.id + '><strong>          ' + add.phone + '</strong></label><br>'
                        temp = temp + '<label for=' + docs.id + '>' + add.email + '</label><br>'
                        if (add.add1 != "") temp = temp + '<label for=' + docs.id + '>' + add.add1 + '</label><br>';
                        if (add.add2 != "") temp = temp + '<label for=' + docs.id + '>' + add.add2 + '</label><br>';
                        if (add.landmark != "") temp = temp + '<label for=' + docs.id + '>' + add.firstName + '</label><br>';

                        temp = temp + '<label for=' + docs.id + '>' + add.city + ',</label>';
                        temp = temp + '<label for=' + docs.id + '>' + add.state + '-</label>';
                        temp = temp + '<label for=' + docs.id + '>' + add.pin + '</label><br>'
                        temp = temp + '</div>'
                        $('#addresses').append(temp);
                    });
                } else {
                    console.log("most recent Addresses doesnt exits");
                    var inital = '<h5 class="mb-4">No Addresses found please all an Address</h5>';
                    await $('#addresses').append(inital);

                }

            });
        }



        async function cart() {
            let db = firebase.firestore();
            var totalItemHtml = document.getElementById("totalItems");

            //     var htmlCode = '<div class="row mb-4" id ="productId"> \
            //     <div class="col-md-5 col-lg-3 col-xl-3">\
            //       <div class="view zoom overlay z-depth-1 rounded mb-3 mb-md-0">\
            //         <img class="img-fluid w-100"\
            //          id="productImage" src="../dp/image/dogf1.jpg" alt="Sample">\
            //         <a href="#!">\
            //           <div class="mask waves-effect waves-light">\
            //             <img class="img-fluid w-100"\
            //             id="productImage1" src="../dp/image/dogf1.jpg">\
            //             <div class="mask rgba-black-slight waves-effect waves-light"></div>\
            //           </div>\
            //         </a>\
            //       </div>\
            //     </div>\
            //     <div class="col-md-7 col-lg-9 col-xl-9">\
            //       <div>\
            //         <div class="d-flex justify-content-between">\
            //           <div>\
            //             <h5 id = "name">Blue denim shirt</h5>\
            //             <p class="mb-3 text-muted text-uppercase small" id="size"></p>\
            //             <p class="mb-2 text-muted text-uppercase small"></p>\
            //             <p class="mb-3 text-muted text-uppercase small" id = "isInStock"></p>\
            //           </div>\
            //           <div>\
            //             <div class="def-number-input number-input safari_only mb-0 w-100">\
            //               <button onclick="return quantityChange(false,this.parentNode.querySelector(\'input[type=number]\'))"\
            //                 class="minus"></button>\
            //               <input class="quantity" min="0" name="quantity" value="1" type="number" id="quantity" min = 0 onchange = valueChanged(this.id,this.value)>\
            //               <button onclick="return quantityChange(true,this.parentNode.querySelector(\'input[type=number]\'))"\
            //                 class="plus"></button>\
            //             </div>\
            //             <small id="passwordHelpBlock" class="form-text text-muted text-center">\
            //               (Note, 1 piece)\
            //             </small>\
            //           </div>\
            //         </div>\
            //         <div class="d-flex justify-content-between align-items-center">\
            //           <div>\
            //             <a type="button" class="card-link-secondary small text-uppercase mr-3" onclick = "return removeItemsFromCart(this.id)" id="removeButton"><i\
            //                 class="fas fa-trash-alt mr-1"  ></i> Remove item </a>\
            //             <a type="button" class="card-link-secondary small text-uppercase"><i\
            //                 class="fas fa-heart mr-1"></i> Move to wish list </a>\
            //           </div>\
            //           <p class="mb-0"><span><strong id ="price"><i class="fas fa-rupee-sign"></i> 540.99</strong></span></p>\
            //         </div>\
            //       </div>\
            //     </div>\
            //   </div>\
            //   <hr class="mb-4">';


            var priceWithDiscountArray = {};
            var discountArray = {};
            var quantityArray = {};
            var totalDiscountArray = {}

            var totalAmountWithDiscountAndQuantity = 0;
            var discountedAmount = 0;
            var totalCostWithoutDiscount = 0;

            firebase.auth().onAuthStateChanged(async(user) => {
                currentUser = user;



                if (user) {

                    await db.collection("CustomerInfo").doc(user.uid).collection("cart").get().then((qs) => {
                        qs.forEach(async(element) => {
                            // console.log(element.id, " => ", element.id);

                            var productId = element.id;
                            var quantity = element.data().quantity;

                            quantityArray[productId] = quantity;
                            await db.collection("Products").doc(productId).get().then((element) => {
                                var htmlCode = ' <div class="sole">\
                        <div class="smallbio" style="width: 15%;">\
                            <img src="" id="productImage" alt="" style="width: 90%;">\
                        </div>\
                        <div class="bigbio" style="padding-left: 20px;">\
                            <h3 style="font-size: 14px;" id="productName"></h3>\
                            <h5 style="font-size: 12px;" id="productSize"></h5>\
                            <p id="price"></p>\
                        </div>\
                    </div>';
                                $("#productList").append(htmlCode);
                                console.log("Poduct id : ", element.id);
                                document.getElementById("productImage").src = element.data().mainImage;
                                document.getElementById("productName").innerHTML = element.data().name;
                                document.getElementById("productSize").innerHTML = element.data().size;
                                document.getElementById("productImage").id = element.id + "Image";
                                document.getElementById("productName").id = element.id + "Name";
                                document.getElementById("productSize").id = element.id + "Size";
                                if (element.data().isInStock) {
                                    var op = element.data().originalPrice;
                                    var discount = op * element.data().salePerc / 100;
                                    //dicount = productdiscount withiut quantity
                                    var finalPrice = (op - discount) * quantity;
                                    //finalPrice = price with discount and quantity

                                    // document.getElementById("price").innerHTML = finalPrice;

                                    //priceWithDiscountArray = array without quantity
                                    priceWithDiscountArray[element.id] = op - discount;

                                    totalAmountWithDiscountAndQuantity = totalAmountWithDiscountAndQuantity + finalPrice;
                                    //discountArray only the discount without quntity
                                    discountArray[element.id] = discount;

                                    //discountammount  = overall discount with product quantity
                                    discountedAmount = discountedAmount + discount * quantity;
                                    //totalDiscountArray  = product discount with quantity
                                    totalDiscountArray[element.id] = discount * quantity;


                                    totalCostWithoutDiscount = totalCostWithoutDiscount + discount * quantity + finalPrice;

                                    document.getElementById("totalCost").innerHTML = totalCostWithoutDiscount;
                                    document.getElementById("totalDiscount").innerHTML = discountedAmount;
                                    document.getElementById("finalCost").innerHTML = totalAmountWithDiscountAndQuantity;
                                    //Change Id of the append Elements

                                    // document.getElementById("name").id = element.id + "name";
                                    // document.getElementById("productId").id = element.id;
                                    // document.getElementById("productImage").id = element.id + "productImage";
                                    // document.getElementById("productImage1").id = element.id + "productImage1";
                                    // document.getElementById("size").id = element.id + "size";
                                    // document.getElementById("isInStock").id = element.id + "isInStock";
                                    // document.getElementById("quantity").id = element.id + "quantity";
                                    // document.getElementById("price").id = element.id + "price";
                                    // document.getElementById("removeButton").id = element.id + "removeButton";

                                    console.log("Completed first product");
                                }
                                // document.getElementById("quantity").value = quantity;
                                //Original price = op

                            });
                        });
                    });


                    console.log("priceWithDiscountArray : ", priceWithDiscountArray);
                    console.log("discount Array: ", discountArray);
                    console.log("Quantity Price Array : ", quantityArray);




                } else {
                    // User not logged in or has just logged out.
                    console.log("User not logged in to add to cart");
                    window.location.assign("https://petzieee.web.app/login/login.html");
                }
            });

        }



        async function buyNow(data) {
            let db = firebase.firestore();
            var totalItemHtml = document.getElementById("totalItems");

            var priceWithDiscountArray = {};
            var discountArray = {};
            var quantityArray = {};
            var totalDiscountArray = {}

            var totalAmountWithDiscountAndQuantity = 0;
            var discountedAmount = 0;
            var totalCostWithoutDiscount = 0;

            firebase.auth().onAuthStateChanged(async(user) => {
                currentUser = user;



                if (user) {
                    var productId = data.name;
                    var quantity = Number(data.quantity);
                    console.log("quantity", data.quantity)
                    quantityArray[productId] = quantity;
                    await db.collection("Products").doc(productId).get().then((element) => {
                        var htmlCode = ' <div class="sole">\
                        <div class="smallbio" style="width: 15%;">\
                            <img src="" id="productImage" alt="" style="width: 90%;">\
                        </div>\
                        <div class="bigbio" style="padding-left: 20px;">\
                            <h3 style="font-size: 14px;" id="productName"></h3>\
                            <h5 style="font-size: 12px;" id="productSize"></h5>\
                            <p id="price"></p>\
                        </div>\
                    </div>';
                        $("#productList").append(htmlCode);
                        console.log("Poduct id : ", element.id);
                        document.getElementById("productImage").src = element.data().mainImage;
                        document.getElementById("productName").innerHTML = element.data().name;
                        document.getElementById("productSize").innerHTML = element.data().size;
                        document.getElementById("productImage").id = element.id + "Image";
                        document.getElementById("productName").id = element.id + "Name";
                        document.getElementById("productSize").id = element.id + "Size";
                        if (element.data().isInStock) {
                            var op = element.data().originalPrice;
                            var discount = op * element.data().salePerc / 100;
                            //dicount = productdiscount withiut quantity
                            var finalPrice = (op - discount) * quantity;
                            //finalPrice = price with discount and quantity

                            // document.getElementById("price").innerHTML = finalPrice;

                            //priceWithDiscountArray = array without quantity
                            priceWithDiscountArray[element.id] = op - discount;

                            totalAmountWithDiscountAndQuantity = totalAmountWithDiscountAndQuantity + finalPrice;
                            //discountArray only the discount without quntity
                            discountArray[element.id] = discount;

                            //discountammount  = overall discount with product quantity
                            discountedAmount = discountedAmount + discount * quantity;
                            //totalDiscountArray  = product discount with quantity
                            totalDiscountArray[element.id] = discount * quantity;


                            totalCostWithoutDiscount = totalCostWithoutDiscount + discount * quantity + finalPrice;


                            document.getElementById("totalCost").innerHTML = totalCostWithoutDiscount;
                            document.getElementById("totalDiscount").innerHTML = discountedAmount;
                            if (discountedAmount == 0) {
                                document.getElementById("ifSaved").innerHTML = "";
                                // document.getElementById("totalDiscount").innerHTML = "";
                            }
                            document.getElementById("finalCost").innerHTML = totalAmountWithDiscountAndQuantity;
                            //Change Id of the append Elements

                            cost = totalAmountWithDiscountAndQuantity
                                // document.getElementById("name").id = element.id + "name";
                                // document.getElementById("productId").id = element.id;
                                // document.getElementById("productImage").id = element.id + "productImage";
                                // document.getElementById("productImage1").id = element.id + "productImage1";
                                // document.getElementById("size").id = element.id + "size";
                                // document.getElementById("isInStock").id = element.id + "isInStock";
                                // document.getElementById("quantity").id = element.id + "quantity";
                                // document.getElementById("price").id = element.id + "price";
                                // document.getElementById("removeButton").id = element.id + "removeButton";

                            console.log("Completed first product");
                        }
                        // document.getElementById("quantity").value = quantity;
                        //Original price = op

                    });

                    console.log("priceWithDiscountArray : ", priceWithDiscountArray);
                    console.log("discount Array: ", discountArray);
                    console.log("Quantity Price Array : ", quantityArray);




                } else {
                    // User not logged in or has just logged out.
                    console.log("User not logged in to add to cart");
                    window.location.assign("https://petzieee.web.app/login/login.html");
                }
            });

        }
    </script>
</body>

</html>